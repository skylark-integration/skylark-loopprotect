/**
 * skylark-loopprotect - A version of jsbin-loopprotect playground) that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylarkn-loopprotect/
 * @license MIT
 */
define([],function(){"use strict";var e=null,n=/\b(for|while|do)\b/g,i=/\b(for|while|do)\b/,t=/\b(?!default:)([a-z_]{1}\w+:)/i,r=/(?:\/\*(?:[\s\S]*?)\*\/)|(?:([\s;])+\/\/(?:.*)$)/gm,o=function(u,a){var f=[],c=u.split("\n"),g=!1,h=o.alias+".protect",d={},b={},p=null;function m(e,n,i){return n.slice(0,i)+"{;"+h+"({ line: "+e+", reset: true }); "+n.slice(i)}a||(a=0);return c.forEach(function(o,u){if(n.lastIndex=0,t.lastIndex=0,!g){-1!==o.toLowerCase().indexOf("noprotect")&&(g=!0);var v=-1,x=-1,w=u,O=u-a+1,k="",y=!1,j=!1,I=!1,E=o.match(n)||[],L=E.length?E[0]:"",T=o.match(t)||[],z=0,B=0,C=!1;if(T.length&&(e("- label match"),s(v=o.indexOf(T[1]),o)?e("- ignored label in string or comment"):l(u,c)?e("- ignored label in multline comment"):function(n,o,l){i.lastIndex=0,t.lastIndex=0;var s=!1,u=l.slice(o).join("\n").substr(n).replace(t,"");return u.replace(i,function(n,i,t){var o=u.substr(0,t).replace(r,"").trim();e("- directlyBeforeLoop: "+o),0===o.length&&(s=!0)}),s}(v,u,c)?(e('- found a label: "'+T[0]+'"'),p=u):e('- ignored "label", false positive')),d[u])e(" -exit: ignoring line "+u+": "+o);else{if(b[u])return e("- exit: ignoring, but adding line "+u+": "+o),void f.push(o);if(L&&1===E.length&&-1===o.indexOf("jsbin")){if(e("match on "+L+"\n"),y="do"===L,x=v=o.indexOf(L),s(v,o))return void f.push(o);if(l(u,c))return void f.push(o);for((v=o.indexOf(L)+L.length)===o.length&&v===o.length&&u<c.length-1&&(e("- moving to next line"),f.push(o),o=c[++u],d[u]=!0,v=0);v<o.length;){if("("===(k=o.substr(v,1))&&z++,")"===k&&0==--z&&!1===I&&(I=v),"{"===k&&B++,"}"===k&&B--,0===z&&(";"===k||"{"===k)){if(";"===k)u!==w?(e("- multiline inline loop"),f[w]=f[w].substring(0,I+1)+"{\nif ("+h+"({ line: "+O+" })) break;\n"+f[w].substring(I+1),o+="\n}}\n"):(e("- single line inline loop"),o=o.substring(0,I+1)+"{\nif ("+h+"({ line: "+O+" })) break;\n"+o.substring(I+1)+"\n}}\n"),C=!0;else if("{"===k){e("- multiline with braces");var D=";\nif ("+h+"({ line: "+O+" })) break;\n";o=o.substring(0,v+1)+D+o.substring(v+1),v+=D.length}if(u===w&&null===p?(e("- simple reset insert"),o=m(O,o,x),v+=(";"+h+"({ line: "+u+", reset: true }); ").length):null===p?(e("- reset inserted above original line"),f[w]=m(O,f[w],x)):(e("- reset inserted above matched label on line "+p),void 0===f[p]&&(p--,x=0),f[p]=m(O,f[p],x),p=null),y){for(e("searching for closing `while` statement for: "+o),j=!1;v<o.length;){if("{"===(k=o.substr(v,1))&&B++,"}"===k&&B--,j=0===B,0===B&&e("outside of closure, looking for `while` statement: "+o),j&&-1!==o.indexOf("while"))return e("- exit as we found `while`: "+o),o+="}",f.push(o),void(d[u]=!0);++v===o.length&&u<c.length-1&&(f.push(o),d[u]=!0,o=c[++u],e(o),v=0)}return}if(C)return void f.push(o);for(e("searching for closing brace of loop for: "+o);null!==o;){if(k=o.substr(v,1),e(v,k,B),"{"===k&&B++,"}"===k&&0==--B)return e("outside of loop, add a close brace to: "+o),o=o.substring(0,v+1)+"}"+o.substring(v+1),f.push(o),void(d[u]=!0);++v>=o.length&&(f.push(o),d[u]=!0,o=c[++u],e(o),v=0)}return}++v===o.length&&u<c.length-1&&(e("- moving to next line"),f.push(o),o=c[++u],d[u]=!0,v=0)}}else e("regular line "+o),f.push(o)}}}),e("---- source ----"),e(u),e("---- rewrite ---"),e(f.join("\n")),e(""),g?u:f.join("\n")};function l(n,i){if(0===n)return!1;var t=n,r=1,o=-1,l=-1;do{if(e("looking backwards "+i[t]),o=i[t].indexOf("*/"),l=i[t].indexOf("/*"),-1!==o&&r++,o===i[t].length-2&&-1!==l&&r--,-1!==l&&0===--r)return e("- exit: part of a multiline comment"),!0;t-=1}while(0!==t);return!1}function s(n,i){for(var t;--n>-1;){if('"'===(t=i.substr(n,1))||"'"===t||"."===t)return e("- exit: matched inside a string or property key"),!0;if(("/"===t||"*"===t)&&(--n,"/"===t))return e("- exit: part of a comment"),!0}return!1}return o.counters={},o.debug=function(n){e=n?function(){console.log.apply(console,[].slice.apply(arguments))}:function(){}},o.debug(!1),o.alias="loopProtect",o.protect=function(e){o.counters[e.line]=o.counters[e.line]||{};var n=o.counters[e.line],i=(new Date).getTime();return e.reset&&(n.time=i,n.hit=0,n.last=0),n.hit++,i-n.time>100?(o.hit(e.line),!0):(n.last++,!1)},o.hit=function(e){var n="Exiting potential infinite loop at line "+e+'. To disable loop protection: add "// noprotect" to your code';console.error(n)},o.reset=function(){o.counters={}},o});
//# sourceMappingURL=sourcemaps/main.js.map
