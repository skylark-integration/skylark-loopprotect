/**
 * skylark-loopprotect - A version of jsbin-loopprotect playground) that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylarkn-loopprotect/
 * @license MIT
 */
!function(e,n){var t=n.define,require=n.require,i="function"==typeof t&&t.amd,r=!i&&"undefined"!=typeof exports;if(!i&&!t){var o={};t=n.define=function(e,n,t){"function"==typeof t?(o[e]={factory:t,deps:n.map(function(n){return function(e,n){if("."!==e[0])return e;var t=n.split("/"),i=e.split("/");t.pop();for(var r=0;r<i.length;r++)"."!=i[r]&&(".."==i[r]?t.pop():t.push(i[r]));return t.join("/")}(n,e)}),resolved:!1,exports:null},require(e)):o[e]={factory:null,resolved:!0,exports:t}},require=n.require=function(e){if(!o.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=o[e];if(!module.resolved){var t=[];module.deps.forEach(function(e){t.push(require(e))}),module.exports=module.factory.apply(n,t)||null,module.resolved=!0}return module.exports}}if(!t)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-loopprotect/main",[],function(){"use strict";var e=null,n=/\b(for|while|do)\b/g,t=/\b(for|while|do)\b/,i=/\b(?!default:)([a-z_]{1}\w+:)/i,r=/(?:\/\*(?:[\s\S]*?)\*\/)|(?:([\s;])+\/\/(?:.*)$)/gm,o=function(u,a){var f=[],c=u.split("\n"),p=!1,d=o.alias+".protect",h={},g={},b=null;function m(e,n,t){return n.slice(0,t)+"{;"+d+"({ line: "+e+", reset: true }); "+n.slice(t)}a||(a=0);return c.forEach(function(o,u){if(n.lastIndex=0,i.lastIndex=0,!p){-1!==o.toLowerCase().indexOf("noprotect")&&(p=!0);var v=-1,x=-1,y=u,k=u-a+1,w="",O=!1,j=!1,E=!1,I=o.match(n)||[],q=I.length?I[0]:"",T=o.match(i)||[],L=0,P=0,z=!1;if(T.length&&(e("- label match"),s(v=o.indexOf(T[1]),o)?e("- ignored label in string or comment"):l(u,c)?e("- ignored label in multline comment"):function(n,o,l){t.lastIndex=0,i.lastIndex=0;var s=!1,u=l.slice(o).join("\n").substr(n).replace(i,"");return u.replace(t,function(n,t,i){var o=u.substr(0,i).replace(r,"").trim();e("- directlyBeforeLoop: "+o),0===o.length&&(s=!0)}),s}(v,u,c)?(e('- found a label: "'+T[0]+'"'),b=u):e('- ignored "label", false positive')),h[u])e(" -exit: ignoring line "+u+": "+o);else{if(g[u])return e("- exit: ignoring, but adding line "+u+": "+o),void f.push(o);if(q&&1===I.length&&-1===o.indexOf("jsbin")){if(e("match on "+q+"\n"),O="do"===q,x=v=o.indexOf(q),s(v,o))return void f.push(o);if(l(u,c))return void f.push(o);for((v=o.indexOf(q)+q.length)===o.length&&v===o.length&&u<c.length-1&&(e("- moving to next line"),f.push(o),o=c[++u],h[u]=!0,v=0);v<o.length;){if("("===(w=o.substr(v,1))&&L++,")"===w&&0==--L&&!1===E&&(E=v),"{"===w&&P++,"}"===w&&P--,0===L&&(";"===w||"{"===w)){if(";"===w)u!==y?(e("- multiline inline loop"),f[y]=f[y].substring(0,E+1)+"{\nif ("+d+"({ line: "+k+" })) break;\n"+f[y].substring(E+1),o+="\n}}\n"):(e("- single line inline loop"),o=o.substring(0,E+1)+"{\nif ("+d+"({ line: "+k+" })) break;\n"+o.substring(E+1)+"\n}}\n"),z=!0;else if("{"===w){e("- multiline with braces");var B=";\nif ("+d+"({ line: "+k+" })) break;\n";o=o.substring(0,v+1)+B+o.substring(v+1),v+=B.length}if(u===y&&null===b?(e("- simple reset insert"),o=m(k,o,x),v+=(";"+d+"({ line: "+u+", reset: true }); ").length):null===b?(e("- reset inserted above original line"),f[y]=m(k,f[y],x)):(e("- reset inserted above matched label on line "+b),void 0===f[b]&&(b--,x=0),f[b]=m(k,f[b],x),b=null),O){for(e("searching for closing `while` statement for: "+o),j=!1;v<o.length;){if("{"===(w=o.substr(v,1))&&P++,"}"===w&&P--,j=0===P,0===P&&e("outside of closure, looking for `while` statement: "+o),j&&-1!==o.indexOf("while"))return e("- exit as we found `while`: "+o),o+="}",f.push(o),void(h[u]=!0);++v===o.length&&u<c.length-1&&(f.push(o),h[u]=!0,o=c[++u],e(o),v=0)}return}if(z)return void f.push(o);for(e("searching for closing brace of loop for: "+o);null!==o;){if(w=o.substr(v,1),e(v,w,P),"{"===w&&P++,"}"===w&&0==--P)return e("outside of loop, add a close brace to: "+o),o=o.substring(0,v+1)+"}"+o.substring(v+1),f.push(o),void(h[u]=!0);++v>=o.length&&(f.push(o),h[u]=!0,o=c[++u],e(o),v=0)}return}++v===o.length&&u<c.length-1&&(e("- moving to next line"),f.push(o),o=c[++u],h[u]=!0,v=0)}}else e("regular line "+o),f.push(o)}}}),e("---- source ----"),e(u),e("---- rewrite ---"),e(f.join("\n")),e(""),p?u:f.join("\n")};function l(n,t){if(0===n)return!1;var i=n,r=1,o=-1,l=-1;do{if(e("looking backwards "+t[i]),o=t[i].indexOf("*/"),l=t[i].indexOf("/*"),-1!==o&&r++,o===t[i].length-2&&-1!==l&&r--,-1!==l&&0===--r)return e("- exit: part of a multiline comment"),!0;i-=1}while(0!==i);return!1}function s(n,t){for(var i;--n>-1;){if('"'===(i=t.substr(n,1))||"'"===i||"."===i)return e("- exit: matched inside a string or property key"),!0;if(("/"===i||"*"===i)&&(--n,"/"===i))return e("- exit: part of a comment"),!0}return!1}return o.counters={},o.debug=function(n){e=n?function(){console.log.apply(console,[].slice.apply(arguments))}:function(){}},o.debug(!1),o.alias="loopProtect",o.protect=function(e){o.counters[e.line]=o.counters[e.line]||{};var n=o.counters[e.line],t=(new Date).getTime();return e.reset&&(n.time=t,n.hit=0,n.last=0),n.hit++,t-n.time>100?(o.hit(e.line),!0):(n.last++,!1)},o.hit=function(e){var n="Exiting potential infinite loop at line "+e+'. To disable loop protection: add "// noprotect" to your code';console.error(n)},o.reset=function(){o.counters={}},o}),e("skylark-loopprotect",["skylark-loopprotect/main"],function(e){return e})}(t),!i){var l=require("skylark-langx-ns");r?module.exports=l:n.skylarkjs=l}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-loopprotect.js.map
